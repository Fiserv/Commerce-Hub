---
tags: [carat, commerce-hub, apple-pay, wallet, apple-pay-inapp-integration]
---

# Apple Pay

## Overview

Our API allows developers to quickly enable secure and convenient payments in their payment applications. The API handles all of the tokenization needed to protect customers’ transactions.

Apple Pay is available to cardholders at participating banks in supported countries. Refer to Apple’s [participating banks](https://support.apple.com/en-us/HT204916) documentation to learn about supported banks and countries.

---

## Start Accepting Apple Pay Transactions

Select an option below to see the integration steps

### [Apple Pay on the Web: RESTful API](#Web-RESTful-API-Integration)

Commerce Hub's RESTful API integration allows the merchant to create a custom UI integration with Apple Pay. The merchant will host the payment processing on their server and has full control over the look and feel. 

<!-- theme: warning -->
> Merchants are required to have the relevant Payment Card Industry (PCI) Compliance capabilities to process and store card data.

#### Transaction Flow

1. The customer selects checkout from the merchant's website and the merchant’s payment form displays.
2. The customer selects Apple Pay and the Apple Pay payment form displays.
3. The customer completes the Apple Pay form and returns to the merchant's website.
4. The customer selects to complete the transaction.
5. The merchant’s website submits the encrypted Apple Pay payload to Commerce Hub.
6. Commerce Hub attempts to process the transaction and sends the response to the merchant’s website.

### [Apple Pay on the Web: Hosted Payment Page](#Web-Hosted-Payment-Page)

Commerce Hub's Hosted Payment Page integration removes the PCI Compliance requirement on the merchant server by handling the payment processing form on Commerce Hub's secure server. The merchant can customize the look and feel of the payment form.

#### Transaction Flow

1. Customer selects checkout from the merchant's website.
2. Customer then presented with the Commerce Hub's secure Hosted Payment Page.
3. Customer selects Apple Pay and then redirected to the Apple Pay payment form.
4. Customer completes the apple pay form and then redirected to the Hosted Payment Page.
5. Customer selects to complete the transaction.
6. Hosted Payment Page submits the encrypted Apple Pay payload to Commerce Hub.
7. Commerce Hub attempts to process the transaction and sends the response to the merchant website.

### [Apple Pay Integration In-App](#In-App-Integration)

Commerce Hub's RESTful API integration allows the merchant to create a custom App integration with Apple Pay. The merchant will present the payment processing form on their App and submit the transaction to Commerce Hub.

#### Transaction Flow

1. Customer selects checkout from the merchant's App.
2. Customer then presented with the merchant's payment form.
3. The App calls the Apple Pay framework to obtain the encrypted wallet data.
4. Merchant's App submits the encrypted Apple Pay payload to Commerce Hub.
5. Commerce Hub attempts to process the transaction and sends the response to the merchant's App.

---

## Web: RESTful API Integration

#### Step 1: Configure Apple Pay on the Web

Configure Apple developer account with merchant information to accept [Apple Pay on the web](https://help.apple.com/developer-account/#/dev1731126fb). This includes creating a merchant identifier, creating a processing certificate, registering the merchant and creating a merchant identity certificate.

- When using *ApplePay*, the merchant will utilize the certificate generated by Commerce Hub. Please contact our Account Representative in order to get the certificate.
- When using *DecryptedWallet*, the merchant will utilize their own certificate.

#### Step 2: Support Apple Pay on the Web

The merchant can start supporting Apple Pay on their website by using the Commerce Hub's [RESTful API](docs/Resources/API-Documents/Use-Our-APIs.md) with [Apple Pay's JS API Framework](https://developer.apple.com/documentation/apple_pay_on_the_web/apple_pay_js_api).

#### Step 3: Presenting the Payment Sheet

The merchant can enhance the purchase experience from their website by creating a streamlined checkout process and presenting a customized Apple Pay payment sheet that allows customers to promptly authorize a payment and complete their transaction. Refer to Apple's website on how to customize the [payment sheet](https://developer.apple.com/design/human-interface-guidelines/apple-pay/overview/checkout-and-payment/#customize-the-payment-sheet).

#### Step 4: Submit a Payment Request

<!--
type: tab
title: Request
-->

##### Example of a Charge Payload Request.
```json
{
   "amount":{
      "total":"12.04",
      "currency":"USD"
   },
   "source":{
      "sourceType":"ApplePay",
      "data":"hbreWcQg980mUoUCfuCoripnHO210lvtizOFLV6PTw1DjooSwik778bH....",
      "header":{
        "applicationDataHash":"94ee059335e587e501cc4bf90613e0814f00a7b08bc7c648fd865a2af6a22cc2",
        "ephemeralPublicKey":"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvR....",
        "publicKeyHash":"KRsyW0NauLpN8OwKr+yeu4jl6APbgW05/TYo5eGW0bQ=",
        "transactionId":"31323334353637"
      },
      "signature":"MIAGCSqGSIb3DQEHAqCAMIACAQExDzANBglghkgBZQMEAgEFADCABgkqhki.....",
      "version":"EC_v1",
      "applicationData":"VEVTVA==",
      "merchantId":"merchant.com.fapi.tcoe.applepay",
      "merchantPrivateKey":"MHcCAQEE234234234opsmasdsalsamdsad/asdsad/asdasd/....."
   },
   "transactionDetails":{
      "captureFlag":true,
      "createToken":true,
      "tokenProvider":"RSA"
   }
   "transactionInteraction":{
      "eciIndicator": "SECURE_ECOM",
   }
}

```

<!--
type: tab
title: Response
-->

##### Example of a Charge (201: Created) Response.

<!-- theme: info -->
> See [Error Responses](url) for additional examples.
```json
{
   "gatewayResponse":{
      "orderId":"R-3b83fca8-2f9c-4364-86ae-12c91f1fcf16",
      "transactionType":"charge",
      "transactionState":"authorized",
      "transactionOrigin":"ecom"
   },
   "transactionProcessingDetails":{
      "transactionDate":"2021-04-16",
      "transactionTime":"2021-04-16T16:06:05Z",
      "apiTraceId":"rrt-0bd552c12342d3448-b-ea-1142-12938318-7",
      "clientRequestId":"30dd879c-ee2f-11db-8314-0800200c9a66",
      "transactionId":"838916029301"
   },
   "source":"ApplePay",
   "paymentToken":{
      "tokenData":"1234123412340019",
      "PARId":"string",
      "declineDuplicates":false,
      "tokenSource":"RSA"
   },
   "paymentReceipt":{
      "approvedAmount":{
         "total":"1.00",
         "currency":"USD"
      },
      "processorResponseDetails":null,
      "approvalStatus":"APPROVED",
      "approvalCode":"OK7118",
      "referenceNumber":"845366457890-TODO",
      "schemeTransactionID":"019078743804756",
      "processor":"fiserv",
      "responseCode":"00",
      "responseMessage":"APPROVAL",
      "hostResponseCode":"54022",
      "hostResponseMessage":"Approved",
      "localTimestamp":"2021-04-16T16:06:05Z",
      "bankAssociationDetails":{
         "associationResponseCode":"000",
         "transactionTimestamp":"2021-04-16T16:06:05Z",
         "transactionReferenceInformation":null
      }
   }
}
```

<!-- type: tab-end -->

---

## Web: Hosted Payment Page

#### Step 1: Configure Apple Pay on the Web

The Apple developer account will need to be configured with the merchant information to accept [Apple Pay on the web](https://help.apple.com/developer-account/#/dev1731126fb). This includes creating a merchant identifier, creating a processing certificate, registering the merchant and creating a merchant identity certificate.

#### Step 2: Support Apple Pay on the Web

The merchant can start supporting Apple Pay on their [Hosted Payment Page](docs/Online-Mobile-Digital/Hosted-Payment-Page/Hosted-Payment-Page.md) by configuring the settings in the Virtual Terminal.

1. Login
2. Click Customize
3. Do this thing.

#### Step 3: Presenting the Payment Sheet

The merchant can enhance the purchase experience from their website by creating a streamlined checkout process and presenting a customized Apple Pay payment sheet that allows customers to promptly authorize a payment and complete their transaction. Refer to Apple's website on how to customize the [payment sheet](https://developer.apple.com/design/human-interface-guidelines/apple-pay/overview/checkout-and-payment/#customize-the-payment-sheet).

---

## In-App Integration

#### Step1: Configure Apple Pay in App

Configure Apple developer account with merchant information to accept [Apple Pay in the App](https://help.apple.com/developer-account/#/devb2e62b839). This includes creating a merchant identifier, enabling Apple Pay in App and creating a processing certificate.

- When using *ApplePay*, the merchant will utilize the certificate generated by Commerce Hub. Please contact our Account Representative in order to get the certificate.
- When using *WalletDecrypted*, the merchant will utilize their own certificate.

#### Step 2: Set-up Project in Xcode

A merchant will need to create a project in Xcode to start supporting Apple Pay in their app. Refer to Apple's website on how to [create the project in Xcode](https://developer.apple.com/documentation/xcode/creating_an_xcode_project_for_an_app) and [enable Apple Pay in Xcode](https://help.apple.com/xcode/mac/9.3/#/deva43983eb7?sub=dev44ce8ef13).

#### Step 3: Submit a Payment Request

The merchant can submit a payment request to Apple to verify if apple pay is supported and to receive the encrypted wallet data. Refer to Apple Pay's [Creating Payment Request](https://developer.apple.com/library/archive/ApplePay_Guide/CreateRequest.html#//apple_ref/doc/uid/TP40014764-CH3-SW2) for more detail.

#### Step 4: Submit a Charge Request

Option 1 - Encrypted Data (wallet encrypted data using apple encryption, commerce hub will decrypt)
Option 2 - Decrypted Wallet (Merchant using their own certificate and they decrypt themselves and send us card data)

<!--
type: tab
title: ApplePay
-->

##### Example of a Charge Payload Request.
```json
{
  "amount": {
    "total": "12.04",
    "currency": "USD"
  },
  "source": {
    "sourceType": "ApplePay",
    "data": "hbreWcQg980mUoUCfuCoripnHO210lvtizOFLV6PTw1DjooSwik778bH....",
    "header": {
      "applicationDataHash": "94ee059335e587e501cc4bf90613e0814f00a7b08bc7c648fd865a2af6a22cc2",
      "ephemeralPublicKey": "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvR....",
      "publicKeyHash": "KRsyW0NauLpN8OwKr+yeu4jl6APbgW05/TYo5eGW0bQ=",
      "transactionId": "31323334353637"
    },
    "signature": "MIAGCSqGSIb3DQEHAqCAMIACAQExDzANBglghkgBZQMEAgEFADCABgkqhki.....",
    "version": "EC_v1",
    "applicationData": "VEVTVA==",
    "merchantId": "merchant.com.fapi.tcoe.applepay",
    "merchantPrivateKey": "MHcCAQEE234234234opsmasdsalsamdsad/asdsad/asdasd/....."
  }
  "transactionDetails": {
    "captureFlag": true,
    "createToken": true,
    "tokenProvider": "RSA"
  }
}

```

<!--
type: tab
title: DecryptedWallet
-->

Add payload here (PaymentCard) add extra data like cryptogram and stuff

<!--
type: tab
title: Response
-->

##### Example of a Charge (201: Created) Response.

<!-- theme: info -->
> See [Error Responses](?path=docs/Resources/Guides/Response-Codes/HTTP.md) for additional examples.
```json
{
  "gatewayResponse": {
    "orderId": "R-3b83fca8-2f9c-4364-86ae-12c91f1fcf16",
    "transactionType": "charge",
    "transactionState": "authorized",
    "transactionOrigin": "ecom"
  },
  "transactionProcessingDetails": {
    "transactionDate": "2021-04-16",
    "transactionTime": "2021-04-16T16:06:05Z",
    "apiTraceId": "rrt-0bd552c12342d3448-b-ea-1142-12938318-7",
    "clientRequestId": "30dd879c-ee2f-11db-8314-0800200c9a66",
    "transactionId": "838916029301"
  },
  "source": "ApplePay",
  "tokenData": "1234123412340019",
  "PARId": "string",
  "declineDuplicates": false,
  "tokenSource": "string",
  "paymentReceipt": {
    "approvedAmount": {
      "total": "1.00",
      "currency": "USD"
    },
    "processorResponseDetails": null,
    "approvalStatus": "APPROVED",
    "approvalCode": "OK7118",
    "referenceNumber": "845366457890-TODO",
    "schemeTransactionID": "019078743804756",
    "processor": "fiserv",
    "responseCode": "00",
    "responseMessage": "APPROVAL",
    "hostResponseCode": "54022",
    "hostResponseMessage": "Approved",
    "localTimestamp": "2021-04-16T16:06:05Z",
    "bankAssociationDetails": {
      "associationResponseCode": "000",
      "transactionTimestamp": "2021-04-16T16:06:05Z",
      "transactionReferenceInformation": null,
    }
  }
}
```
<!-- type: tab-end -->

---

## See Also

- [API Explorer](../api/?type=post&path=/payments/v1/charges)
- [Charges](?path=docs/Resources/API-Documents/Payments/Charges.md)
- [Google Pay](?path=docs/Online-Mobile-Digital/Wallets-AltPayments/Google-Pay/Google-Pay.md)

---
