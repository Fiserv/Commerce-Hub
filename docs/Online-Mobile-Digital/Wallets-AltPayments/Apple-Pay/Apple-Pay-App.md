---
tags: [In-App, Online, Apple Pay, Wallet, Mobile]
---

# Apple Pay: In-App Integration

Commerce Hub's RESTful API integration allows the merchant to create a custom App integration with Apple Pay. The merchant will present the payment processing form on their App and submit the transaction to Commerce Hub.

### How it Works

1. The customer selects checkout from the merchant's app and the merchant’s payment form displays.
2. The app calls the Apple Pay framework to obtain the encrypted wallet data.
3. The merchant’s app submits the encrypted Apple Pay payload to Commerce Hub.
4. Commerce Hub attempts to process the transaction and sends the response to the merchant’s app.

---

## Step 1: Configure Apple Pay

Configure Apple developer account with merchant information to accept [Apple Pay in the App](https://help.apple.com/developer-account/#/devb2e62b839). This includes creating a merchant identifier, processing certificate, and enabling Apple Pay in App.

- When using *ApplePay*, the merchant will utilize the `applePayMerchantId` and [certificate](?path=docs/Resources/Guides/Dev-Studio/Certificate-Management.md) generated by Commerce Hub.
- When using *DecryptedWallet*, the merchant will utilize their own certificate.

---

## Step 2: Set-up Project in Xcode

A merchant will need to create a project in Xcode to start supporting Apple Pay in their app. Refer to Apple's website on how to [create the project in Xcode](https://developer.apple.com/documentation/xcode/creating_an_xcode_project_for_an_app) and [enable Apple Pay in Xcode](https://help.apple.com/xcode/mac/9.3/#/deva43983eb7?sub=dev44ce8ef13).

---

## Step 3: Submit a Payment Request

The merchant can submit a payment request to Apple to verify if apple pay is supported and to receive the encrypted wallet data. Refer to Apple Pay's [Creating Payment Request](https://developer.apple.com/library/archive/ApplePay_Guide/CreateRequest.html#//apple_ref/doc/uid/TP40014764-CH3-SW2) for more detail.

---

## Step 4: Submit a Charge Request

- [**Encrypted Data:**](#request-variables) The data is encrypted using Apple's encryption and Commerce Hub will decrypt the information.
- [**Decrypted Wallet:**](?path=docs/Resources/Guides/Payment-Sources/Decrypted-Wallet.md) The data is encrypted and decrypted using a merchant's certificate and the card data is submitted to Commerce Hub.

---

### Request Variables

<!--
type: tab
titles: source, header
-->

The below table identifies the required parameters in the `source` object.

| Variable | Type| Maximum Length | Required | Description |
|---------|----------|-------|---------|---------|
|`sourceType` | *string* | 15 | &#10004; | Value *ApplePay* is used for Apple Pay request. Refer Payment [source type](?path=docs/Resources/Guides/Payment-Sources/Source-Type.md) for more details. |
| `data` | *string* | 4000 | &#10004; | Encrypted Data. Payment data dictionary, Base64 encoded as a string. |
| `header` | *object* | N/A| &#10004; | Additional version-dependent information used to decrypt and verify the payment. |
| `signature` | *string* | 4000 | &#10004; | Signature of the payment and header data. The signature includes the signing certificate, its intermediate CA certificate, and information about the signing algorithm. Detached PKCS #7 signature, Base64 encoded as string. |
| `version` | *string* | 64 | &#10004; | Specific Protocol version supported by Apple. Version information about the payment token. The token uses EC_v1 for ECC-encrypted data, and RSA_v1 for RSA-encrypted data. |
| `applicationData` | *string* | 4000 |  | Hash of the applicationData property of the original PKPaymentRequest object. If the value of that property is nil, this key is omitted. SHA–256 hash, hex encoded as a string. |
| `applePayMerchantId` | *string* | 256 | &#10004; | Unique AppID registered in the [Commerce Hub Developer portal](?path=docs/Resources/Guides/Dev-Studio/Certificate-Management.md) |
| `merchantPrivateKey` | *string* | 256 | &#10004; | Merchant private key - Hex encoded |

<!--
type: tab
-->

The below table identifies the required parameters in the `header` object.

| Variable | Type | Maximum Length | Required | Description |
| -------- | -- | ------------ | ---------|--------- |
| `applicationDataHash` | *string* | 256 | | Encrypted app data |
| `ephemeralPublicKey` | *string* | 256 | &#10004; | Used to derive the actual Public Key. Ephemeral public key bytes. EC_v1 only. X.509 encoded key bytes, Base64 encoded as a string. |
| `publicKeyHash` | *string* | 256 | &#10004; | Hash of the X.509 encoded public key bytes of the merchant’s certificate. SHA–256 hash, Base64 encoded as a string. |
| `transactionId` | *string* | 256 | &#10004; | Transaction ID generated by the Apple device. A hexadecimal identifier, as a string. |

<!-- type: tab-end -->

### Payload Example

<!-- theme:info -->
>Merchants managing their own encryptions will send a [Decrypted Wallet](?path=docs/Resources/Guides/Payment-Sources/Decrypted-Wallet.md) payload request.

<!--
type: tab
titles: Request, Response
-->

##### Example of a charge payload request.

```json
{
  "amount": {
    "total": "12.04",
    "currency": "USD"
  },
  "source": {
    "sourceType": "ApplePay",
    "data": "hbreWcQg980mUoUCfuCoripnHO210lvtizOFLV6PTw1DjooSwik778bH....",
    "header": {
      "applicationDataHash": "94ee059335e587e501cc4bf90613e0814f00a7b08bc7c648fd865a2af6a22cc2",
      "ephemeralPublicKey": "MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEvR....",
      "publicKeyHash": "KRsyW0NauLpN8OwKr+yeu4jl6APbgW05/TYo5eGW0bQ=",
      "transactionId": "31323334353637"
    },
    "signature": "MIAGCSqGSIb3DQEHAqCAMIACAQExDzANBglghkgBZQMEAgEFADCABgkqhki.....",
    "version": "EC_v1",
    "applicationData": "VEVTVA==",
    "applePayMerchantId": "merchant.com.organizationname.unitname.commonname",
    "merchantPrivateKey": "MHcCAQEE234234234opsmasdsalsamdsad/asdsad/asdasd/....."
  }
  "transactionDetails": {
    "captureFlag": true,
    "createToken": false
  },
  "merchantDetails":{
      "merchantId": "123456789789567",
      "terminalId": "123456"
    }
}

```

<!--
type: tab
-->

##### Example of a charge (201: Created) response.

<!-- theme: info -->
> See [Response Handling](?path=docs/Resources/Guides/Response-Codes/Response-Handling.md) for more information.

```json

{
   "gatewayResponse":{
      "transactionType": "CHARGE",
      "transactionState": "AUTHORIZED",
      "transactionOrigin": "ECOM",
      "transactionProcessingDetails":{
         "transactionTimestamp": "2021-06-20T23:42:48Z",
         "orderId": "RKOrdID-525133851837",
         "apiTraceId": "362866ac81864d7c9d1ff8b5aa6e98db",
         "clientRequestId": "4345791",
         "transactionId": "84356531338"
      }
   },
   "source":{
      "sourceType": "DecryptedWallet",
      "card":{
         "bin": "40055500",
         "last4": "0019",
         "scheme": "VISA",
         "expirationMonth": "10",
         "expirationYear": "30"
      },
      "cavv": "01ade6ae340005c681c3a1890418b53000020000",
      "wallet": "APPLE_PAY"
   },
   "paymentReceipt":{
      "approvedAmount":{
         "total": 12.04,
         "currency": "USD"
      },
      "merchantName": "Merchant Name",
      "merchantAddress": "123 Peach Ave",
      "merchantCity": "Atlanta",
      "merchantStateOrProvince": "GA",
      "merchantPostalCode": "12345",
      "merchantCountry": "US",
      "merchantURL": "https://www.somedomain.com",
      "processorResponseDetails":{
         "approvalStatus": "APPROVED",
         "approvalCode": "OK5882",
         "schemeTransactionId": "0225MCC625628",
         "processor": "FISERV",
         "hohst": "NASHVILLE",
         "responseCode": "000",
         "responseMessage": "APPROVAL",
         "hostResponseCode": "00",
         "hostResponseMessage": "APPROVAL",
         "localTimestamp": "2021-06-20T23:42:48Z",
         "bankAssociationDetails":{
            "associationResponseCode": "000",
            "transactionTimestamp": "2021-06-20T23:42:48Z"
         }
      }
   },
   "transactionDetails":{
      "captureFlag": true,
      "merchantInvoiceNumber": "123456789012"
   }
}
```

<!-- type: tab-end -->

---

## See Also

- [API Explorer](../api/?type=post&path=/payments/v1/charges)
- [Certificate Signing Request](?path=docs/Resources/Guides/Dev-Studio/Certificate-Management.md)
- [Charge Request](?path=docs/Resources/API-Documents/Payments/Charges.md)
- [Decrypted Wallet](?path=docs/Resources/Guides/Payment-Sources/Decrypted-Wallet.md)
- [Apple Pay Web Integration - RESTful API](?path=docs/Online-Mobile-Digital/Wallets-AltPayments/Apple-Pay/Apple-Pay-Web-REST.md)
- [Google Pay](?path=docs/Online-Mobile-Digital/Wallets-AltPayments/Google-Pay/Google-Pay.md)

<!--
- [Samsung Pay](?path=docs/Online-Mobile-Digital/Wallets-AltPayments/Samsung-Pay/Samsung-Pay.md)
- [Apple Pay Web Integration - Hosted Page](?path=docs/Online-Mobile-Digital/Wallets-AltPayments/Apple-Pay/Apple-Pay-Web-HPP.md)
-->

---
